<!DOCTYPE html>
<html>
   <head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
      <title>IT黑名单</title>
      <meta name="keywords" content="黑名单,名单,黑公司,公司,IT黑公司,IT公司,职场黑公司" />
	  <meta name="description" content="爆料黑公司，后来人谨慎入坑。IT黑名单，BLACKLIST.CN" />
      
      <link rel="icon" type="image/x-icon" href="/img/favicon.ico">
	  <link href="css/bootstrap.min.css" rel="stylesheet">
	  <link rel="stylesheet" type="text/css" href="css/bootstrap-select.css">
	  <link rel="stylesheet" type="text/css" href="css/bootstrap-markdown.min.css">
	  
	  <script src="js/jquery.min.js"></script>
	  <script src="js/bootstrap.min.js"></script>
	  <script src="js/bootstrap-select.js"></script>
	  <script src="js/markdown.js"></script>
	  <script src="js/bootstrap-markdown.js"></script>
	  <script src="js/to-markdown.js"></script>
	  <script src="js/city.js"></script>
	  <script src="js/angular.min.js"></script>
	  <script type="text/javascript">
	$(window).on('load', function () {
		$('.selectpicker').selectpicker({'selectedText': 'cat'});
    });
  </script>
  <script src="js/baidutj.js"></script>
   </head>
   <body class=""><h1></h1>
	<div class="jumbotron container">
		<div class="form-group">
			<a href="/"><h2><span class="col-sm-6 glyphicon glyphicon-home"></span></h2></a>
			<span class="col-sm-6 text-right" id="sApp" ng-app="sApp" ng-controller="sCtrl">
				<form class="form-inline">
					<input type="text" ng-model="name" placeholder="公司名" class="form-control">
					<button class="btn btn-default" ng-click="submit()" type="button">
						Search!
					</button>
				</form>
			</span>
		</div>
		
		<div id="lApp" ng-app="lApp" ng-controller="lCtrl">
			<h3 class="text-center">关于{{kw}}的公司</h3>
			<p class="" ng-repeat="r in list" style="text-indent:2em;">
				<a href="javascript:void(0);" ng-click="details(r.ref)">
					{{r.sketch}}——{{r.company}}
				</a>
			</p>
			<div ng-if="list.length<1">
				<p>暂无{{kw}}的数据，提交请点击<a href="#" data-toggle="modal" data-target="#myModal">这里</a></p>
			</div>
		</div>
	</div>
	
	<div class="modal fade" id="msgModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		<div class="modal-dialog modal-lg">
			 <div class="modal-content">
				<div class="modal-body">success!</div>
			</div>
		</div>
	</div>
	
	<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div class="modal-content" id="myApp" ng-app="myApp" ng-controller="myCtrl">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true"> &times; </button>
				<h4 class="modal-title" >
				  填写资料
				</h4>
			</div>
			<div class="modal-body">
				<form class="form-horizontal">
					<div class="form-group">
						<label class="col-sm-2 control-label">所在城市</label>
						<div class="col-sm-8">
							<select class="selectpicker bla bla bli" multiple data-live-search="true" required>
								<option ng-repeat="city in citys">{{city}}</option>
							</select>*
						</div>
					</div>
					<div class="form-group">
						<label class="col-sm-2 control-label">公司名称</label>
						<div class="col-sm-8">
							<input type="text" ng-model="company" name="company" placeholder="公司全名" required>*
						</div>
					</div>
					<div class="form-group">
						<label class="col-sm-2 control-label">类型</label>
						<div class="col-sm-8">
							<input type="text" ng-model="sketch" name="sketch" placeholder="类型" required>*
							<span class="help-block">Example:拖欠工资/推延离职...</span>
						</div>
					</div>
					<div class="form-group">
						<label class="col-sm-2 control-label">详细描述</label>
						<div class="col-sm-8">
							<textarea class="bt-md" ng-model="content" name="content" data-provide="markdown" rows="10"></textarea>
						</div>
					</div>
					<div class="form-group">
						<label class="col-sm-2 control-label">联系方式</label>
						<div class="col-sm-8">
							<input type="text" ng-model="contact" name="contact" placeholder="email/qq/tel...">
							<span class="help-block">不会在网站展示，仅供进一步确认问题，选填</span>
						</div>
					</div>
					<div class="form-group">
						<label class="col-sm-2 control-label"><input type="checkbox" checked disabled="disabled" /></label>
						<div class="col-sm-8">
							<span class="help-block">以上内容均系用户个人行为，不代表本网站意见，本站不为以上内容承担任何法律责任。</span>
						</div>
					</div>
				</form>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
				<button type="submit" ng-click="submit()" class="btn btn-primary">提交</button>
			</div>
        </div>
      </div><!-- /.modal-content -->
    </div><!-- /.modal -->
	
	
	<div class="container">
		<div class="container text-center">
			© Copyright 2016 IT黑名单 Inc.All Rights Reserved. <a href="http://www.miitbeian.gov.cn">豫ICP备15018592号-2</a>
		</div>
	</div>
	
	
	<script>
		var myApp = angular.module('myApp',[]);
		myApp.controller('myCtrl', function($scope, $http) {
			$scope.citys = citys;
			$scope.submit = function() {
				var message = $('.bt-md').data('markdown').parseContent();
				$http({
					method:'post',
					url:'/topic/add',
					data:{'tsno':new Date().getMilliseconds(),'city':t,'company':$scope.company,
							'sketch':$scope.sketch,'intro':message,'contact':$scope.contact},
					headers:{'Content-Type':'application/x-www-form-urlencoded; charset=UTF-8'},
					transformRequest:function(data){return $.param(data);}
				}).success(function(data){
					if("100"==data.code) {
						$("#myModal").modal('hide');
						$("#msgModal").modal();
					} else {
						$("#msgModal .modal-body").html(data.desc);
						$("#msgModal").modal();
					}
				});
			}
		});
		var sApp = angular.module('sApp',[]);
		sApp.controller('sCtrl', function($scope){
			$scope.submit = function() {
				window.location.href=encodeURI('/list.html?kw='+$scope.name);
			}
		});
		var lApp = angular.module('lApp',[]);
		lApp.controller('lCtrl', function($scope, $http) {
			$scope.details = function(i) {
				window.location.href=encodeURI('details.html?t='+i);
			}
			
			$scope.kw = getURLParameter('kw');
			$scope.list = [];
			$http({
				method:'post',
				url:'/topic/s',
				data:{'tsno':new Date().getMilliseconds(),'key':$scope.kw},
				headers:{'Content-Type':'application/x-www-form-urlencoded; charset=UTF-8'},
				transformRequest:function(data){return $.param(data);}
			}).success(function(data){
				console.log(data);
				if("100"==data.code) {
					var res = data.response;
					for(var i=0;i<res.length;i++) {
						var topic = {};
						topic.ref = res[i].id;
						topic.sketch = res[i].sketch;
						topic.company = res[i].company;
						$scope.list[i] = topic;
					}
				}
			});
		});
		
		function getURLParameter(name) {
			return decodeURIComponent((new RegExp('[?|&]' + name + '=' + '([^&;]+?)(&|#|;|$)').exec(location.search)||[,""])[1].replace(/\+/g, '%20'))||null;
		}
		angular.bootstrap(document.getElementById("sApp"), ['sApp']);
		angular.bootstrap(document.getElementById("lApp"), ['lApp']);
		angular.bootstrap(document.getElementById("myApp"), ['myApp']);
	</script>
</body>
</html>